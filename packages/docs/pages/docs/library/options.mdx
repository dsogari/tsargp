---
title: Options - Library - Docs
---

import { Callout } from 'nextra/components';

# Options

Any command-line interface is composed of commands and options (also known as _flags_). Options
allow the calling application or user to configure the command that will run. **tsargp** offers a
selection of option types that should suit most applications. In the next sections, we present the
available types and describe them in detail.

## Option types

There is a total of ten option types, as summarized in the table below:

| Option type | Parameters                              | Data type          | Normalization      | Constraints         |
| ----------- | --------------------------------------- | ------------------ | ------------------ | ------------------- |
| [help]      | niladic                                 | `never{:ts}`[^1]   |                    |                     |
| [version]   | niladic                                 | `never{:ts}`[^1]   |                    |                     |
| [function]  | niladic                                 | `unknown{:ts}`[^2] |                    |                     |
| [command]   | not applicable                          | `unknown{:ts}`[^2] |                    |                     |
| [flag]      | niladic                                 | `boolean{:ts}`     |                    |                     |
| [boolean]   | positional, monadic                     | `boolean{:ts}`     |                    |                     |
| [string]    | positional, monadic                     | `string{:ts}`      | trim, case         | enums, regex        |
| [number]    | positional, monadic                     | `number{:ts}`      | conv               | enums, range        |
| [strings]   | positional, delimited, variadic, append | `string[]{:ts}`    | unique, trim, case | enums, regex, limit |
| [numbers]   | positional, delimited, variadic, append | `number[]{:ts}`    | unique, conv       | enums, range, limit |

The meaning of each column is explained below.

### Option type

The `type` attribute of an option definition indicates the type of the option. It is the only
required attribute of any option. It is used as a [discriminant] for determining the avaiable
attributes of each specific option.

### Option parameters

The parameters column indicates how many parameters an option expects on the command-line:

- _niladic_ - no parameter
- _monadic_ - a single parameter
- _variadic_ - a variable number of parameters
- _delimited_ - a single parameter in which values are delimited by a [separator]
- _append_ - the option can be specified multiple times, with the elements being appended
- _not applicable_ - the command option does not accept "parameters"; rather, it starts a new
  parsing loop with the remaining command-line arguments

In the case of non-niladic options, the parameter(s) can be made optional by setting a [fallback
value].

### Option value

The data type column indicates the base type of the option value in the [resulting object]. Except
for the help and version options, which do not have values, the initial value of any option is
`undefined{:ts}`.

### Normalization & constraints

All options that accept parameters can be configured with normalization and contraint attributes.
These attributes indicate how the option value should be transformed after being parsed, and if it
should comply with any value constraints.

## Common attributes

This section describes attributes that are common to a subset of option types. The options
themselves will be explained later in this page.

### Basic attributes

All options share a set of attributes in addition to their type, which are described below.

<Callout type="default">None of these attributes is required, except for the `type`.</Callout>

#### Names & preferred name

The `names` attribute lists the option names as they may appear on the command-line (e.g. `-h` or
`--help`). Names must not contain whitespace or the equals sign `'='{:ts}`, since this character may
be used as an option-value separator. If the option is not positional (i.e., it does not accept
positional arguments), then it must contain at least one valid name.

The `preferredName` attribute, if present, is displayed in error and help messages in cases where a
name is not available (e.g., when evaluating option requirements or processing positional arguments).
It is not validated, so it can be any string. If not specified, the first name in the `names` array
will be used.

#### Synopsis & deprecated

The `desc` attribute is the option synopsis. The `deprecated` attribute specifies the option
deprecation reason. Both attributes are formatted in the help message according to [text
formatting] rules.

<Callout type="info">
  Deprecated options specified on the command-line generate a [warning message], which you may want
  to obtain by calling the parser's [`parseInto`] method.
</Callout>

#### Group & hide

The `group` attribute is the name of a group under which the option should appear in the help
message. The `hide` attribute indicates to the formatter that the option should _not_ be displayed
in the help message.

<Callout type="default">
  You can assign a unique group to the [positional option] (if there is one) and place it first in
  the option definitions, in order to highlight it in the help message.
</Callout>

#### Display styles

The `styles` attribute can be used to customize the [styling] of the help message entry for the
option. It has the following optional properties:

- `names` - the style of the option names
- `param` - the style of the option paramater
- `descr` - the style of the option description

#### External reference

The `link` attribute is the URL of an external resource or media, that is included in the help
message if specified.

### Value attributes

All option types that may have a value share a set of attributes, which are described below.

#### Always required

The `required` attribute indicates that the option is _always_ required, regardless of other
options. Mutually exclusive with [default value] and [conditional requirements].

#### Default value

The `default` attribute, if present, specifies a value that is used if the option is specified
neither on the command-line nor as an [environment variable]. Mutually exclusive with [always
required].

Both [function options] and [command options] accept any kind of value as the default. In the case
of object values, it's useful to specify a custom `toString` method in order to render it in the
help message, e.g.:

```ts
toString() {
  return JSON.stringify(this);
}
```

<Callout type="info">This value is only evaluated at the end of the parsing loop.</Callout>

##### Default callback

If the value is not known beforehand (e.g., if it depends on the values of other options), you may
want to use a callback to inspect parsed values and determine the default based on those values. It
accepts one parameter:

- `values` - the parsed values

Notes about this callback:

- if can be asynchronous
- it may be configured with a custom `toString` method to render it in the help message

#### Forward requirements

The `requires` attribute, if present, specifies requirements that must be satisfied _if_ the option
is specified on the command-line. It can be either:

- an option key;
- an object that maps option keys to required values;
- a requirement expression; or
- a requirement callback

In the case of an option key, the referenced option must also be present on the command-line.
In the case of an object, every referenced option must have the corresponding value.
In the case of an expression, it is evaluated as follows:

- `req.all` - an expression that is satisfied only when _all_ items are satisfied
- `req.one` - an expression that is satisfied when _at least one_ item is satisfied
- `req.not` - an expression that is satisfied when the item is _not_ satisfied.

<Callout type="default">
  When an object is specified, `undefined{:ts}` values can be used to signify required _presence_,
  and `null{:ts}` values to signify required _absence_.
</Callout>

##### Requirement callback

You can also specify a callback, which accepts the following parameter:

- `values` - the parsed values

Notes about this callback:

- it can be asynchronous
- it should return `true{:ts}` if the requirements were satisfied, or `false{:ts}` otherwise
- it may be configured with a custom `toString` method to render it in error and help messages

<Callout type="info">
  You cannot reference options from a [nested command] (parent or child) in a requirement. Option
  keys must always refer to options in the same set of option definitions.
</Callout>

#### Conditional requirements

The `requiredIf` attribute, if present, specifies conditional requirements. They behave like the
reverse of the previous attribute: they indicate requirements that must be satisfied for the
affected option to be _considered_ required. Mutually exclusive with [always required].

An example might help elucidate this distinction. Suppose we have these requirements:

```ts
req.all(
  'option1',
  req.one({ option2: null }, req.not({ option3: [2] })),
  (values) => values['option1'] === values['option3'],
);
```

If they were defined in the `requires` attribute, they would mean:

> _If this option is specified (either on the command-line or in an environment variable), then the
> following must hold true: `option1` must be present AND (`option2` must be absent OR `option3`
> must have a value different than `[2]`) AND `option1` must have the same value as `option3`._

If they were defined in the `requiredIf` attribute, they would mean:

> _If `option1` is present AND (`option2` is absent OR `option3` has a value different than `[2]`)
> AND `option1` has the same value as `option3`, then this option is considered required and must be
> specified (either on the command-line or in an environment variable)._

<Callout type="info">
  During requirement evaluation, values are compared _after_ being normalized.
</Callout>

#### Cluster letters

The `clusterLetters` attribute, if present, specifies letters (or any Unicode characters except
whitespace) that can be used to cluster options in the first command-line argument. This is also
known as [_short-option_ style]. This feature can be enabled via the parser's [`shortStyle`]
configuration flag.

Here is an example that illustrates how it works. Suppose we have the following options:

- flag option, with name `'--flag'{:ts}` and letters `'fF'{:ts}`
- string option, with name `'--str'{:ts}` and letters `'sS'{:ts}`
- number option, with name `'--num'{:ts}` and letters `'nN'{:ts}`

Given these options, the following invocations would be equivalent:

```sh
my_cli fsn 'my string' 123
my_cli -fsn 'my string' 123
my_cli fSN 'my string' 123
my_cli -Fsn 'my string' 123
```

They would all be transformed to their "canonical" form, i.e.:

```sh
my_cli --flag --str 'my string' --num 123
```

Notes about this feature:

- the order of the options in the cluster are preserved when converting to the canonical form
- variadic array options and command options are supported, but they must be the last in a cluster
- if a single dash is specified as the first character in a cluster argument, it is ignored
- if `Tab`-completion is performed in a cluster argument, the default completion is thrown
- positional options with no names are skipped in a cluster argument

### Parameter attributes

All non-niladic option types share a set of attributes, which are described below.

#### Example value

The `example` attribute, if present, specifies a value that replaces the option type in the help
message. Mutually exclusive with [parameter name].

#### Parameter name

The `paramName` attribute, if present, specifies a parameter name that replaces the option type in
the help message. Mutually exclusive with [example value].

#### Positional | marker

The `positional` attribute, if present, indicates that the option accepts _positional_ arguments.
There may be at most _one_ option with this setting.

If set to `true{:ts}`, then any argument not recognized as an option name will be considered
positional. If set to a string, then it acts as positional marker, and all arguments that appear
_beyond_ the marker will be considered positional.

When using this attribute, we recommend also setting [preferred name] to some explanatory name.

#### Complete callback

The `complete` attribute, if present, specifies a [custom callback] for word completion. This can be
used to make better suggestions than the [default algorithm] would do for the option.

It accepts a single parameter that contains the current [argument information], in which `comp` is
the word being completed. In the case of array-valued options, the `param` property holds the option
parameters preceding `comp`, if any.

Notes about this callback:

- it can be asynchronous
- it should return the list of completion words
- if an error is thrown, it is ignored, and the default completion message is thrown instead

#### Parse callback

The `parse` attribute, if present, specifies a [custom callback] to parse the value of the option
parameter(s).

It accepts a single parameter that contains the current [argument information], in which `param`
holds the option parameter(s). The `comp` property indicates whether word completion is in effect
(but not in the current iteration).

Notes about this callback:

- it can be asynchronous
- it should return the new option value

#### Enumeration

The `enums` attribute, if present, specifies enumerated values that the option accepts as parameter.
Any parameter that does not equal one of these values (after normalization) will cause an error to
be thrown. Explicitly _not_ available for the [boolean option]. Mutually exclusive with [regular
expression] and [numeric range].

#### Fallback value

The `fallback` attribute, if present, specifies a value that is used when the option is specified
in the command-line _without_ any parameter. This makes the option parameter(s) optional, for both
single-valued and array-valued options. If not specified, the option parameter(s) will be required.

You may also specify a callback that returns the fallback value, with same semantics as the [default
callback].

<Callout type="info">
  This attribute is inherently different from the [default value] (i.e., they are not mutually
  exclusive).
</Callout>

### String attributes

String-valued option types share a set of attributes, as described below.

#### Regular expression

The `regex` attribute, if present, specifies a regular expression that string parameters should
match. Any parameter that does _not_ match the regular expression (after normalization) will cause
an error to be thrown. Mutually exclusive with [enumeration].

#### Trim whitespace

The `trim` attribute, if present, indicates that string parameters will be trimmed (i.e., have
leading and trailing whitespace removed). This normalization is applied _before_ checking value
constraints.

#### Case conversion

The `case` attribute, if present, specifies the kind of case conversion to apply to string
parameters. Can be one of `'lower'{:ts}` (convert to lowercase) or `'upper'{:ts}` (convert to
uppercase). This normalization is applied _before_ checking value constraints.

### Number attributes

Number-valued option types share a set of attributes, as described below.

#### Numeric range

The `range` attribute, if present, specifies a (closed) numeric range that number parameters should
be within. Any parameter that is _not_ within the given range (after normalization) will cause an
error to be thrown. You may want to use `[-Infinity, Infinity]{:ts}` to disallow `NaN{:ts}`.
Mutually exclusive with [enumeration].

#### Math convertion

The `conv` attribute, if present, specifies the kind of math convertion to apply to number
parameters. Can be any of JavaScript's [Math] functions that accept a single number parameter. This
normalization is applied _before_ checking value constraints.

### Array attributes

Array-valued option types share a set of attributes, as described below.

#### Separator

The `separator` attribute, if present, specifies a delimiter by which to split parameter values. If
specified, the option will accept a single parameter and not multiple parameters[^3]. It can be
either a string or a regular expression.

#### Remove duplicates

The `unique` attribute, if present, indicates that duplicate elements will be removed from the
option value. Due to the nature of JavaScript's [Set] type, the order of array elements will reflect
the order in which they were parsed. This normalization is applied _before_ checking the [count
limit] constraint.

#### Append values

The `append` attribute, if present, indicates that the option allows appending elements to its value
if specified multiple times on the command-line. Both the [remove duplicates] normalization and the
[count limit] constraint, if enabled, are applied after appendage.

#### Count limit

The `limit` attribute, if present, indicates the maximum allowed number of array elements. Any
parameter that causes the option value to _exceed_ the given limit (after normalization) will cause
an error to be thrown.

### Miscellaneous attributes

Some attributes are shared by all valued option types except [function options] and [command
options]. They are described below.

#### Environment variable

The `envVar` attribute, if present, specifies the name of an environment variable from which the
option value should be extracted, in case the option is not specified on the command-line.

<Callout type="info">
  If the environemnt variable for an option is found, the option is counted as if it were specified
  on the command-line, which has implications for the evaluation of option requirements.
</Callout>

## Niladic options

Niladic options do not expect any parameter on the command-line. With the notable exception of the
[flag option], these options may have _side-effects_.

<Callout type="info">
  When word completion is in effect, help and version options are _not_ processed.
</Callout>

### Help option

The **help** option is a convenient specialization of the [function option] that handles the
formatting of help messages. Internally, it instantiates a [formatter] class with the provided
configuration, obtains a formatted message and throws it. The application is responsible for
catching this message and printing it in a terminal.

This option has the following optional attributes.

#### Help format

The `format` attribute specifies a custom [formatter configuration] configuration.

#### Help sections

The `sections` attribute specifies [help sections] to be rendered in the help message. By default,
two sections are included:

- usage section - with `'Usage:'{:ts}` as heading - indented by 2 spaces
- groups section - with `'Options'{:ts}` as default group heading - appending a colon to group
  headings

#### Use filters

The `useFilters` attribute is an opt-in feature that allows the remaining arguments to be used as
[option filters]. For example, the invocation `cli --help flag` would only include in the help
message those options whose names, synopsis or environemnt variable name match the regex
`/flag/i{:ts}`.

#### Save message

By default, the help option will throw the help message to be printed in the terminal. However, this
behavior can be changed with the `saveMessage` attribute. If present, it indicates that the message
should be saved as the option value instead of being thrown.

### Version option

The **version** option is another specialization of the [function option] that throws a version
message. You may specify either of the following attributes.

#### Version info

The `version` attribute specifies a semantic version or version information. Mutually exclusive with
[resolve callback].

#### Save message

By default, the version option will throw a message to be printed in the terminal. However, this
behavior can be changed with the `saveMessage` attribute. If present, it indicates that the message
should be saved as the option value instead of being thrown.

#### Resolve callback

The `resolve` attribute specifies a resolution function scoped to the module where a `package.json`
file will be searched and read to extract its `version` field. You should use
[`import.meta.resolve`] for this attribute.

Notes about this callback:

- for use in non-browser environments only
- mutually exclusive with [version info]

### Function option

The **function** option executes a generic callback function and saves its result as the option
value. You can use it to perform many kinds of actions, such as:

- reading configuration from a file
- parsing key-value pairs into an object
- altering the values of previous options
- altering the option definitions in response to an option value
  - e.g., if `--verbose` is set, add more help items to the help option's [format]

In addition to the set of [value attributes], it has the following attributes.

#### Function callback

The `exec` attribute specifies the [custom callback] that should be executed.

It accepts a single parameter that contains the current [argument information], in which `param`
holds the remaining command-line arguments and `comp` indicates whether word completion is in effect
(but not in the current iteration).

In the above object, `isComp` can be used to check whether any of the remaining arguments is to be
completed, when `comp` is true. If so, you can throw a new [completion message] inside the callback.

Notes about this callback:

- it can be asynchronous
- the returned value, if any, will be saved as the option value
- altering the `param` property will have _no_ effect on the original command-line arguments

<Callout type="default">
  Inside this callback, you may check whether an option has been specified before it by comparing
  its value with `undefined{:ts}`. This works because default values are only set at the end of the
  parsing loop.
</Callout>

#### Break loop

The `break` attribute indicates whether the parser should exit the parsing loop after returning from
the callback.

<Callout type="warning">
  When setting this attribute, the requirements of all options specified up to the current iteration
  (including the function option) will be verified. Hence, you should make it clear in the help
  message that any option required by the affected one must be specified _before_ it.
</Callout>

#### Skip count

The `skipCount` attribute indicates the number of remaining arguments to skip, after the callback
returns. You may change this value inside the callback. The parser does not alter this value and
ignores it during word completion.

Here is an example of how it might be used inside the callback:

```ts
{
  // other attributes...
  exec(_, _, rest: Array<string>) {
    this.skipCount = 1;
    return JSON.parse(rest[0]);
  },
}
```

### Command option

The **command** option is yet another specialization of the [function option] that handles the
execution of a "nested" command. It lets you specify the command's options in one of its attributes.
The parser will process the remaining arguments and supply the parsed values to the command's
callback, subsequently exiting the parsing loop.

<Callout type="default">
  As you might have guessed, this option allows the definition of hierarchical commands, including
  _recursive_ ones. This is explained in detail in the [commands guide].
</Callout>

In addition to the set of [value attributes], it has the following attributes.

#### Command callback

The `exec` attribute specifies the [custom callback] that should be executed.

It accepts a single parameter that contains the current [argument information], in which `param`
holds the values parsed for the command.

Notes about this callback:

- it can be asynchronous
- the returned value, if any, will be saved as the option value
- when word completion is in effect, this callback will _not_ be called

<Callout type="default">
  The simplest implementation would just return `cmdValues`. This way, the values can be handled
  after the parser returns from the parsing loop.
</Callout>

<Callout type="info">
  Please note that the library does not offer a direct way for a command to access the parsed values
  of ancestor commands (except its immediate parent) during parsing. However, this can be achieved
  by waiting until the parser returns from the parsing loop before acting upon the option values.
</Callout>

#### Command options | callback

The `options` attribute specifies the set of option definitions for the command, or a
(non-asynchronous) callback that returns these definitions (which allows the implementation of
[recursive commands]). This attribute is required.

<Callout type="warning">
  All incoming arguments will be parsed using the option definitions from this attribute, not those
  from the parent command. Hence, you should make it clear in the help message that all arguments
  pertaining to the command must be specified _after_ it.
</Callout>

#### Short-option style

The `shortStyle` property indicates whether the first command argument is expected to be an option
cluster. This must be used in conjunction with the [cluster letters] of the command's options.

### Flag option

The **flag** option is unique in the sense that it is both niladic and has an intrinsic boolean
value. It differs from the [boolean option] in that it does _not_ expect a parameter. While the
latter can be configured to have a [fallback value] (thus making its parameter optional), that
potentially introduces ambiguity of whether arguments are positional or not.

For example, consider the command line `cmd -b 1`, where `-b` is a boolean option with a fallback
value and there is a positional option. In this case, would `1` be a parameter to `-f` or a
positional argument? The parser is implemented to consider it a parameter to `-f`. However, the flag
option completely solves this ambiguity.

In addition to the set of [value attributes] and [miscellaneous attributes], it has the following
optional attribute.

#### Negation names

The `negationNames` attribute specifies alternate option names that can be used to turn the option
value `false{:ts}` (e.g., _--no-flag_). This is particularly useful in scripting scenarios where a
flag that has been previously specified must be reset by a supplementary list of arguments.

## Non-niladic options

Non-niladic options expect one or more parameters on the command-line.

### Boolean option

The **boolean** option accepts a single parameter that is converted to boolean. Any string that
either evaluates to a zero number or is one the words `false`, `no`, or `off` (ignoring case), is
considered `false{:ts}`. Any other string is considered `true{:ts}`. This option has the following
sets of attributes:

- [parameter attributes] for a `boolean{:ts}` data type
- [value attributes]
- [miscellaneous attributes]

### String option

The **string** option accepts a single parameter that is normalized according to the constraints
specified in its definition. It has the following sets of attributes:

- [parameter attributes] for a `string{:ts}` data type
- [value attributes]
- [string attributes]
- [miscellaneous attributes]

### Number option

The **number** option accepts a single parameter that is converted to `Number{:ts}` and normalized
according to the constraints specified in its definition. It has the following sets of attributes:

- [parameter attributes] for a `number{:ts}` data type
- [value attributes]
- [number attributes]
- [miscellaneous attributes]

### Strings option

The **strings** option accepts multiple parameters that are normalized according to the constraints
specified in its definition. It has the following sets of attributes:

- [parameter attributes] for a `string[]{:ts}` data type
- [value attributes]
- [string attributes]
- [array attributes]
- [miscellaneous attributes]

### Numbers option

The **numbers** option accepts multiple parameters that are converted to `Number{:ts}` and
normalized according to the constraints specified in its definition. It has the following sets of
attributes:

- [parameter attributes] for a `number[]{:ts}` data type
- [value attributes]
- [number attributes]
- [array attributes]
- [miscellaneous attributes]

[help]: #help-option
[version]: #version-option
[function]: #function-option
[command]: #command-option
[flag]: #flag-option
[boolean]: #boolean-option
[string]: #string-option
[number]: #number-option
[strings]: #strings-option
[numbers]: #numbers-option
[enumeration]: #enumeration
[separator]: #separator
[format]: #help-format
[flag option]: #flag-option
[command options]: #command-option
[nested command]: #command-option
[boolean option]: #boolean-option
[function option]: #function-option
[function options]: #function-option
[always required]: #always-required
[positional option]: #positional--marker
[default value]: #default-value
[default callback]: #default-callback
[conditional requirements]: #conditional-requirements
[environment variable]: #environment-variable
[always required]: #always-required
[parameter name]: #parameter-name
[example value]: #example-value
[preferred name]: #names--preferred-name
[regular expression]: #regular-expression
[numeric range]: #numeric-range
[parse callback]: #parse-callback
[count limit]: #count-limit
[remove duplicates]: #remove-duplicates
[resolve callback]: #resolve-callback
[version info]: #version-info
[value attributes]: #value-attributes
[miscellaneous attributes]: #miscellaneous-attributes
[parameter attributes]: #parameter-attributes
[string attributes]: #string-attributes
[number attributes]: #number-attributes
[array attributes]: #array-attributes
[cluster letters]: cluster-letters
[formatter]: formatter
[fallback value]: #fallback-value
[commands guide]: ../guides/commands
[recursive commands]: ../guides/commands
[styling]: styles#styling-attributes
[resulting object]: parser#option-values
[text formatting]: styles#text-splitting
[warning message]: styles#warning-message
[default algorithm]: parser#completion-algorithm
[help format]: formatter#help-format
[help sections]: formatter#help-sections
[option filters]: formatter#option-filters
[custom callback]: parser#custom-callbacks
[argument information]: parser#argument-information
[completion message]: styles#completion-words
[`parseInto`]: parser#using-your-own-object
[`shortStyle`]: parser#short-option-style
[formatter configuration]: formatter#help-format
[Set]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set
[Math]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math
[`import.meta.resolve`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import.meta/resolve
[_short-option_ style]: https://www.linuxtopia.org/online_books/linux_tool_guides/tar_user_guide/Short-Options.html
[discriminant]: https://www.typescriptlang.org/docs/handbook/2/narrowing.html#discriminated-unions

[^1]: help and version options throw a message instead of having a value.
[^2]: the return type of the function or command callback.
[^3]: we say that it is _delimited_, rather than _variadic_.
