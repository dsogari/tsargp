---
title: Validator - Library - Docs
---

import { Callout } from 'nextra/components';

# Validator

The `OptionValidator` component handles validation of option definitions. It can be instantiated with a set of option definitions and provides a single method to perform the validation.

<Callout type="info">

Messages produced by the validator can be customized via [message configuration].

</Callout>

## Option validation

We use the term _validation_ to refer to the "sanity check" of option definitions. It is meant for use during development, whereas in production it would impose an unnecessary performance penalty on your application. In this sense, validations behave like assertions: they assert that your program will work as expected when delivered to end-users.

To validate a set of option definitions, you must call the `validate` method on the validator instance. This method accepts a `ValidationFlags` argument with the following optional properties:

- `noNamingIssues` - whether the validation procedure should skip detection of naming inconsistencies
- `noRecurse` - whether the validation procedure should skip recursion into [nested options]

It returns a promise that resolves to a `ValidationResult` object with the following properties:

- `warning` - A compilation of warning messages that represent non-impeditive issues encountered in the option definitions. You may want to inspect it to see if they are important to your application.

<Callout type="info">

This method is _asynchronous_, so you must use `await{:ts}` in order to resolve the returned promise.

</Callout>

## Validation rules

There are two kinds of validation rules, depending on whether they generate an error or a warning. They are listed below.

### Validation errors

The following restrictions will raise an error on any option definition that fails to satisfy it, with an explanatory message that may include the option's key.

- **Invalid option name** - An option name or [positional marker] must not contain whitespace or the equals sign `'='{:ts}`, since this character can be used as option-parameter separator on the command-line. Any other Unicode character is allowed.
- **Duplicate option name** - An option should not have duplicate names, and there cannot be two options with the same name.
- **Invalid cluster letter** - A cluster letter must not contain whitespace or the equals sign `'='{:ts}`. Any other Unicode character is allowed.
- **Duplicate cluster letter** - An option should not have duplicate cluster letters, and there cannot be two options with the same letter.
- **Duplicate choice value** - In a single- or array-valued option with [parameter choices], the choices must _not_ contain duplicate values.
- **Invalid parameter count** - In a function option with a range [parameter count], the minimum value should be strictly less than the maximum, but not less than zero.
- **Option requiring itself** - An option must not declare a requirement that references itself.
- **Unknown required option** - An option must not declare a requirement that references an _unknown_ option.
- **Invalid required option** - An option must not declare a requirement that references a non-valued option (help or version) in a requirement.
- **Invalid required value** - An option must not declare a requirement that references another option that is either [always required] or has a [default value], if the required value is nullish (`null{:ts}` or `undefined{:ts}`).
- **Duplicate positional option** - Since positional arguments have no name, they must pertain to exactly one option. Hence, there cannot be _two_ options with the positional attribute in the same set of option definitions.

<Callout type="info">

`null{:ts}` values from the [option names] are ignored in name validation.

</Callout>

The validator does not validate the _satisfiability_ of option requirements, not only because it cannot evaluate [requirement callbacks] at validation time, but also because [requirement expressions] can be arbitrarily complex. For example, a simple expression like `req.all({opt:1}, {opt:2}){:ts}` cannot be satisfied, but is hard to verify in general[^1].

### Validation warnings

The following restrictions will produce a warning that is returned by the validation procedure.

- **Too similar names** - When two option names are very similar (e.g., if they differ by a single character in a five-character name), this may be a development mistake, or worse, it can become a source of headaches for end-users. Hence, the validator tries to find names that closely match a given name using the same algorithm employed by the parser in [name suggestions], only a little stricter to avoid false positives.
- **Mixed naming convention** - When a [name slot] contains names with different naming conventions (e.g., all-uppercase vs all-lowercase, or single-dash vs double-dash), this may be a sign of code review negligence, or worse, it can make it hard for end-users to reason about your application. Thus, the validator tries to find names within a slot that contain mixed naming patterns.
- **Variadic option with cluster letter** - A variadic option that declares [cluster letters] must always be the last option in a cluster argument. This includes [subcommand] options, array-valued options and function options with a variable [parameter count]. This might not be the intended behavior and if so, you should consider alternatives.

{/* self references */}

[^1]: This problem is known as [B-SAT], which is known to be [NP-complete] in the general case.

[value validation]: #value-validation

{/* options references */}

[subcommand]: options#command-option
[nested options]: options#nested-options--callback
[example value]: options#example-value
[option names]: options#option-names
[positional marker]: options#positional--marker
[parameter choices]: options#parameter-choices
[regular expression]: options#regular-expression
[element count limit]: options#element-count-limit
[default callbacks]: options#default-callback
[positional]: options#positional--marker
[always required]: options#always-required
[required]: options#disable--require-inline
[default value]: options#default-value
[parameter count]: options#parameter-count
[cluster letters]: options#cluster-letters
[truth and falsity]: options#truth--falsity-names
[inline constraint]: options#disable--require-inline
[requirement callbacks]: options#requirement-callback
[requirement expressions]: options#requirement-expression

{/* styles references */}

[message configuration]: styles#message-configuration

{/* formatter references */}

[name slot]: formatter#name-slots

{/* parser references */}

[name suggestions]: parser#name-suggestions
[inline parameter]: parser#inline-parameters

{/* external references */}

[B-SAT]: https://www.wikiwand.com/en/Boolean_satisfiability_problem
[NP-complete]: https://www.wikiwand.com/en/NP-complete
